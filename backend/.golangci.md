# Go Linting Configuration

This document describes the golangci-lint configuration for the sermon-uploader backend, following enterprise 2025 Go development standards.

## Overview

The `.golangci.yml` configuration file provides comprehensive linting rules focused on:
- **Security**: Preventing common vulnerabilities and security issues
- **Performance**: Optimizing for Raspberry Pi deployment
- **Code Quality**: Maintaining high standards for enterprise development
- **Error Handling**: Ensuring robust error management
- **Maintainability**: Keeping code readable and maintainable

## Enabled Linters

### Security Linters
- **gosec**: Security analyzer for Go code, checking for common security issues
  - Credential detection
  - SQL injection prevention
  - TLS configuration validation
  - File permission checks
  - Cryptographic best practices

### Performance Linters
- **prealloc**: Finds slice declarations that could be pre-allocated
- **bodyclose**: Ensures HTTP response bodies are closed
- **noctx**: Detects HTTP requests without context

### Error Handling
- **errcheck**: Ensures error return values are checked
- **errorlint**: Validates error handling patterns
- **rowserrcheck**: Checks that sql.Rows.Err is checked

### Code Quality
- **govet**: Official Go static analysis tool
- **staticcheck**: Advanced static analysis
- **unused**: Finds unused code
- **ineffassign**: Detects ineffectual assignments
- **gocritic**: Comprehensive code analysis

### Complexity Management
- **gocyclo**: Cyclomatic complexity (max: 15)
- **cyclop**: Package-level complexity analysis
- **gocognit**: Cognitive complexity (max: 20)
- **funlen**: Function length limits (80 lines, 40 statements)
- **nestif**: Nested if statement depth (max: 5)

### Style and Formatting
- **gofmt**: Standard Go formatting
- **gofumpt**: Stricter formatting than gofmt
- **goimports**: Import organization with local prefix
- **stylecheck**: Style guide enforcement
- **revive**: Fast, configurable, extensible Go linter

## Configuration Highlights

### Go Version
- Configured for **Go 1.23** with latest features and best practices

### File Exclusions
- Protocol buffer generated files (`*.pb.go`)
- Generated files (`*_gen.go`, `*.gen.go`)
- Mock files (`mock_*.go`, `*_mock.go`)
- Vendor directories

### Complexity Limits
```yaml
Cyclomatic Complexity: 15 (max)
Cognitive Complexity: 20 (max)
Function Length: 80 lines / 40 statements
Nested If Depth: 5 levels (max)
Line Length: 120 characters
```

### Test File Handling
- Relaxed rules for test files
- Excluded from complexity checks
- Allowed weak random generators for testing
- Reduced error checking requirements

## Usage

### Command Line
```bash
# Run all linters
golangci-lint run --config .golangci.yml

# Auto-fix issues where possible
golangci-lint run --config .golangci.yml --fix

# Verbose output
golangci-lint run --config .golangci.yml --verbose
```

### Using Makefile
```bash
# Basic linting
make lint

# Auto-fix issues
make lint-fix

# Full development workflow
make pre-commit

# Complete CI pipeline
make ci
```

### Pre-commit Integration
The linting is automatically integrated into the git pre-commit hook located at `.githooks/pre-commit`.

## Installation

### golangci-lint
```bash
# macOS (Homebrew)
brew install golangci-lint

# Go install (any platform)
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

# Using the provided Makefile
make install-tools
```

### Enable Git Hooks
```bash
# From the backend directory
git config core.hooksPath .githooks
```

## Enterprise Standards Compliance

### Security Standards
- **OWASP Top 10** coverage through gosec rules
- **CWE (Common Weakness Enumeration)** detection
- Cryptographic best practices enforcement
- Input validation and sanitization checks

### Performance Standards
- Memory allocation optimization for Pi deployment
- HTTP resource management
- Context propagation requirements
- Goroutine leak prevention

### Code Quality Standards
- **SOLID principles** enforcement through various linters
- **DRY (Don't Repeat Yourself)** through duplication detection  
- **YAGNI (You Aren't Gonna Need It)** through unused code detection
- Consistent naming conventions and formatting

### Error Handling Standards
- Explicit error checking (no silent failures)
- Proper error wrapping and context
- Structured error handling patterns
- Resource cleanup validation

## Customization

### Adding Custom Rules
Edit `.golangci.yml` to:
- Enable/disable specific linters
- Adjust complexity thresholds
- Add custom exclusions
- Configure linter-specific settings

### Project-specific Exclusions
```yaml
issues:
  exclude-rules:
    - path: specific_file.go
      linters: [specific-linter]
    - text: "specific error pattern"
      linters: [linter-name]
```

## Integration with IDE

### VS Code
Install the `Go` extension which includes golangci-lint integration.

### GoLand/IntelliJ
Enable golangci-lint in Settings → Tools → File Watchers.

### Vim/Neovim
Use plugins like `ale` or `vim-go` with golangci-lint support.

## Troubleshooting

### Common Issues
1. **"golangci-lint: command not found"**
   - Install golangci-lint using the methods above
   - Ensure it's in your PATH

2. **"Configuration file not found"**
   - Ensure you're running from the backend directory
   - Verify `.golangci.yml` exists

3. **"Too many issues found"**
   - Use `--fix` flag to auto-fix simple issues
   - Gradually address issues by category
   - Consider temporarily disabling specific linters during migration

### Performance Tips
- Use `--fast` flag for quicker feedback during development
- Run specific linters: `golangci-lint run --disable-all --enable=gosec`
- Utilize caching for better performance

## Continuous Integration

The configuration is designed for enterprise CI/CD pipelines:
- Strict error handling prevents silent failures
- Security scanning prevents vulnerable code deployment
- Performance checks ensure optimal Pi deployment
- Comprehensive test coverage requirements

For CI integration, use the provided Makefile targets:
```bash
make ci  # Full CI pipeline
```

This ensures consistent code quality across all environments and deployments.